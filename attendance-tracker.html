<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BLMS Science Olympiad ‚Äî Attendance Tracker</title>

<style>
:root{
  --bg-light: linear-gradient(135deg,#e9f0ff,#f7f8ff);
  --bg-dark: linear-gradient(135deg,#0f1320,#1a1227);
  --text: #111318;
  --text-inv: #f4f6ff;
  --card: rgba(255,255,255,.7);
  --card-dark: rgba(36,38,46,.85);
  --border: rgba(0,0,0,.1);
  --border-dark: rgba(255,255,255,.15);
}

/* === NAV BAR === */
.nav {
  position: fixed;
  top: 18px;
  left: 20px;
  z-index: 100;
  display: flex;
  gap: 14px;
  flex-wrap: wrap;
  padding: 10px 16px;
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.3);
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}
.nav a {
  color: var(--text);
  text-decoration: none;
  font-weight: 600;
  font-size: 0.95rem;
  position: relative;
  transition: color 0.2s ease, transform 0.2s ease;
}
.nav a:hover {
  color: #007aff;
  text-shadow: 0 0 10px rgba(0,122,255,0.4);
  transform: scale(1.05);
}
.nav a.active {
  background: linear-gradient(90deg, #007aff, #9b7bff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 800;
}

/* === PAGE BASE === */
html[data-theme="dark"] body{ background: var(--bg-dark); color: var(--text-inv); }
body{
  font-family: -apple-system,BlinkMacSystemFont,"SF Pro Display","Segoe UI",Roboto,Arial,sans-serif;
  background: var(--bg-light);
  color: var(--text);
  min-height: 100vh; margin:0; display:flex; justify-content:center; align-items:flex-start; padding:70px 36px 36px;
}
.container{
  width: min(920px, 96vw);
  background: var(--card);
  border:1px solid var(--border);
  border-radius: 20px;
  box-shadow: 0 10px 28px rgba(0,0,0,.18);
  backdrop-filter: blur(18px);
  padding: 24px 28px;
}
html[data-theme="dark"] .container{ background: var(--card-dark); border:1px solid var(--border-dark); }

h1{
  margin: 6px 0 14px;
  text-align:center;
  background: linear-gradient(90deg,#007aff,#9b7bff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.toolbar{
  display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center;
  margin-bottom: 10px;
}
.toolbar label{ font-weight:600; }
.toolbar input[type="date"]{
  padding:10px 12px; border-radius:10px; border:1px solid var(--border);
}
.btn{
  padding:10px 18px; border:none; border-radius:999px; cursor:pointer; font-weight:650; color:#fff;
  background: linear-gradient(90deg,#007aff,#9b7bff);
}
.btn.secondary{ background:#6b7280; }
.btn.warn{ background:#ef4444; }
.btn.ok{ background:#10b981; }
.btn.info{ background:#6366f1; }

.helpers{
  display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:center; margin: 6px 0 4px;
  font-size:.95rem;
}
.helpers label{ display:flex; gap:6px; align-items:center; cursor:pointer; }

.grid{
  margin-top:10px;
  display:grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap:10px;
}
.card{
  display:flex; align-items:center; gap:10px;
  border:1px solid var(--border); border-radius:12px; padding:10px 12px; background:rgba(255,255,255,.55);
}
html[data-theme="dark"] .card{ border:1px solid var(--border-dark); background:rgba(255,255,255,.08); }
.card label{ flex:1; }

.status-dot{
  width:10px; height:10px; border-radius:50%;
  background:#d1d5db; border:1px solid rgba(0,0,0,.12);
}
.card[data-status="P"] .status-dot{ background:#10b981; }
.card[data-status="A"] .status-dot{ background:#ef4444; }
.card[data-status="E"] .status-dot{ background:#f59e0b; }

.toast{
  position: fixed; left:50%; transform:translateX(-50%);
  bottom: 22px; padding:10px 16px; border-radius:10px; color:#fff; background:#10b981;
  box-shadow:0 8px 22px rgba(0,0,0,.28); opacity:0; pointer-events:none; transition: opacity .35s ease;
}
.toast.show{ opacity:1; }

.toggle{
  position: fixed; top:12px; right:14px; padding:8px 14px; border-radius:999px; border:1px solid var(--border);
  background: rgba(255,255,255,.7); cursor:pointer;
}
html[data-theme="dark"] .toggle{ border:1px solid var(--border-dark); background: rgba(36,38,46,.85); color:#f4f6ff; }

/* === Login overlay === */
#loginOverlay{
  position: fixed; inset:0; background: rgba(0,0,0,.8); backdrop-filter: blur(8px);
  display:flex; align-items:center; justify-content:center; z-index:9999;
}
.login{
  width:min(420px,92vw); background:#fff; border-radius:18px; padding:28px;
  box-shadow:0 12px 32px rgba(0,0,0,.5); text-align:center;
}
.login h2{ margin:0 0 10px; color:#007aff; }
.login input{
  width:100%; padding:11px 13px; border-radius:10px; border:1px solid #d1d5db; margin:10px 0 14px; font-size:1rem;
}
.login .btn{ width:100%; }
.login .err{ color:#ef4444; font-weight:700; min-height:20px; margin-top:6px; }
.small{ font-size:.9rem; opacity:.8; }
</style>
</head>
<body>

<!-- === NAVIGATION BAR === -->
<nav class="nav">
  <a href="index.html" data-page="index">üè† Home</a>
  <a href="roster.html" data-page="roster">üë• Team Roster</a>
  <a href="tournaments.html" data-page="tournaments">üèÜ Tournaments</a>
  <a href="attendance-tracker.html" data-page="attendance-tracker">üóìÔ∏è Attendance-Tracker</a>
  <a href="attendance-report.html" data-page="attendance-report">üìä Attendance Report</a>
</nav>

<button class="toggle" id="themeToggle">‚òÄÔ∏è Light / üåô Dark</button>

<!-- === Login === -->
<div id="loginOverlay">
  <div class="login">
    <h2>Teacher Access</h2>
    <input type="password" id="pw" placeholder="Enter password" />
    <button class="btn info" id="loginBtn">Login</button>
    <div class="err" id="loginErr"></div>
    <div class="small">Tip: this login is page-only (not Google auth). You can change the password in the code.</div>
  </div>
</div>

<!-- === Attendance Tracker === -->
<div class="container" id="app" style="display:none;">
  <h1>Attendance ‚Äî BLMS Science Olympiad</h1>

  <div class="toolbar">
    <label>Date: <input type="date" id="datePicker" required></label>
    <button class="btn ok" id="markP">Mark Present</button>
    <button class="btn warn" id="markA">Mark Absent</button>
    <button class="btn" id="markE" style="background:#f59e0b">Mark Excused</button>
    <button class="btn secondary" id="clearSel">Clear Selection</button>
    <button class="btn info" id="submitBtn">Submit</button>
  </div>

  <div class="helpers">
    <label><input type="checkbox" id="selectAll"> Select all</label>
    <span id="selCount">0 selected</span>
  </div>

  <div class="grid" id="list"></div>
</div>

<div class="toast" id="toast">‚úÖ Attendance recorded</div>

<script>
/* === Highlight current page in nav === */
const currentFile = location.pathname.split('/').pop().replace('.html', '');
document.querySelectorAll('.nav a').forEach(a => {
  if (a.dataset.page === currentFile || (currentFile === '' && a.dataset.page === 'index')) {
    a.classList.add('active');
  }
});

document.addEventListener("DOMContentLoaded", () => {
  // ===== CONFIG =====
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyoBlmpsgE_IhSnuH5ao9LgNzOtwkmqnbupyFno04QUN01Pcuk30eX09xIs1GlklTDi/exec";
  const TEACHER_PASSWORD = "blms2025";

  const students = [
    "Aarav Singh Mandhar","Shreya Ayyalasomayajula","Yvaine Wang","Junye Huang","Sanvi Byreddy",
    "Vinay Patel","Saanvika Nair","Ryan Thomas","Anay Chatterjee","Dhruv Bajaj","Sofia Shao",
    "Akshay Bhargav Varanasi","Edmund Bao","Pavel Chudnovskiy","Anvika Rath","Jayden Oh",
    "William Wang","Akhil Gollapally","Joann Antony","Nora Ahmed","Haasini Bharathwaj",
    "Anvi Dhome","Krishvee Anand","Rayansh Anand","Pavaki Rastogi","Samira Senthil","Ishani Bhat",
    "Zayna Rasheed","Ishaan Parthasarathy","Aarav Singhai"
  ];

  // ===== THEME =====
  const themeToggle = document.getElementById("themeToggle");
  themeToggle.addEventListener("click", () => {
    const html = document.documentElement;
    html.dataset.theme = html.dataset.theme === "dark" ? "light" : "dark";
    localStorage.setItem("att_theme", html.dataset.theme || "light");
  });
  const savedTheme = localStorage.getItem("att_theme") || "light";
  if (savedTheme === "dark") document.documentElement.dataset.theme = "dark";

  // ===== LOGIN =====
  const loginOverlay = document.getElementById("loginOverlay");
  const loginBtn = document.getElementById("loginBtn");
  const loginErr = document.getElementById("loginErr");
  const app = document.getElementById("app");
  if (sessionStorage.getItem("att_ok") === "1") {
    loginOverlay.style.display = "none";
    app.style.display = "block";
  }
  loginBtn.addEventListener("click", () => {
    const pw = document.getElementById("pw").value.trim();
    if (pw === TEACHER_PASSWORD) {
      sessionStorage.setItem("att_ok","1");
      loginOverlay.style.display = "none";
      app.style.display = "block";
    } else {
      loginErr.textContent = "Incorrect password.";
    }
  });

  // ===== RENDER LIST =====
  const list = document.getElementById("list");
  const selCount = document.getElementById("selCount");
  const selectAll = document.getElementById("selectAll");

  function render(){
    list.innerHTML = "";
    students.forEach(name => {
      const row = document.createElement("div");
      row.className = "card";
      row.innerHTML = `
        <input type="checkbox" class="pick" />
        <span class="status-dot"></span>
        <label>${name}</label>
      `;
      row.dataset.name = name;
      list.appendChild(row);
    });
    updateSelCount();
  }
  render();

  function getCheckedRows(){
    return Array.from(document.querySelectorAll(".card .pick:checked"))
      .map(cb => cb.closest(".card"));
  }
  function mark(status){
    getCheckedRows().forEach(row => row.dataset.status = status);
  }
  function clearSelection(){
    document.querySelectorAll(".card .pick").forEach(cb => cb.checked = false);
    updateSelCount();
  }
  function updateSelCount(){
    const count = document.querySelectorAll(".card .pick:checked").length;
    selCount.textContent = `${count} selected`;
  }

  list.addEventListener("change", e => {
    if (e.target.classList.contains("pick")) updateSelCount();
  });
  selectAll.addEventListener("change", e => {
    const on = e.target.checked;
    document.querySelectorAll(".card .pick").forEach(cb => cb.checked = on);
    updateSelCount();
  });

  document.getElementById("markP").addEventListener("click", () => mark("P"));
  document.getElementById("markA").addEventListener("click", () => mark("A"));
  document.getElementById("markE").addEventListener("click", () => mark("E"));
  document.getElementById("clearSel").addEventListener("click", clearSelection);

  // ===== SUBMIT =====
  const toast = document.getElementById("toast");
  function showToast(msg="‚úÖ Attendance recorded"){
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 1800);
  }

  document.getElementById("submitBtn").addEventListener("click", async () => {
    const date = document.getElementById("datePicker").value;
    if (!date) { alert("Pick a date first."); return; }

    const rows = Array.from(document.querySelectorAll(".card"))
      .filter(row => row.dataset.status)
      .map(row => ({ date, name: row.dataset.name, status: row.dataset.status }));

    if (rows.length === 0) { alert("Select students and set a status first."); return; }

    try{
      await fetch(SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(rows)
      });
      showToast();
      document.querySelectorAll(".card").forEach(row => row.dataset.status="");
      clearSelection();
    }catch(err){
      alert("Submit failed: " + err.message);
    }
  });
});
</script>
</body>
</html>
